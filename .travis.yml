language: node_js
node_js: '10'
sudo: required
services:
- docker
env:
  global:
  - GIT_SHA=$( git rev-parse HEAD )
  - SC_DEMO_USER_PASSWORD=schulcloud
  - BACKEND_URL=https://api.schul-cloud.org
  - PUBLIC_BACKEND_URL=https://api.schul-cloud.org
  - FEATURE_TEAMS_ENABLED=true
addons:
  chrome: stable
  firefox: latest
before_install:
  - mkdir schulcloud-client
  - mv !(schulcloud-client) schulcloud-client
  - git clone https://github.com/schul-cloud/schulcloud-server.git schulcloud-server
  - git clone https://github.com/schul-cloud/docker-compose.git docker-compose
  - cd docker-compose && docker-compose -f docker-compose.integration-test.yml up -d && cd ..
  - git clone https://github.com/schul-cloud/integration-tests.git integration-tests
  - cd integration-tests
  - npm ci
  - cd ..
  - sleep 5
script:
  - echo $TRAVIS_BRANCH
  - echo $TRAVIS_TAG
  - cd integration-tests && node index.js -d -t @teacherLogin
after_success:
  - bash ./deploy.sh
